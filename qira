#!/bin/bash
set -e

BIN=$(realpath $1)

if [ -z $BIN ]; then
  echo "usage: $0 <target binary>"
  exit -1
fi

rm -f /tmp/qira_binary
ln -s $BIN /tmp/qira_binary

# build qemu if we have the source
if [ -d "qemu/qemu-latest" ]; then
  pushd .
  cd qemu/qemu-latest
  make -j32
  popd
fi

# detect which qemu to run based on the file
shift
qira-i386 -singlestep /tmp/qira_binary $@

